/* 
Sprite Draw Fork by OutlawEric

-Original Spritegen Code 2004 Credits-
Sam Hocevar
eishiya - diagonal mirroring code
vk - palettes, scale2x code
surt - misc
*/

"use strict";function indexFromCoord(e,t,a){return a*e+t}function ByteMap(e,t){Uint8Array.call(this,e*t),this.width=e,this.height=t}function LinearCongruentialGenerator(e,t,a){this.a=e,this.c=t,this.m=a,this.seed=0}function random(){return(lcg0.random()+lcg1.random())%1}function randomReseed(e){lcg0.reseed(e),lcg1.reseed(lcg0.random())}function errorHandler(e,t,a){alert(e+"\n"+t+"\nLine: "+a);var r=!0;return r}function arraycopy(e,t,a,r,o){for(var n=0;n<o;++n)e[t+n]=a[r+n]}function getPixel(e,t,a){if(t>=0&&t<e.width&&a>=0&&a<e.height){var r=new Array;return arraycopy(r,0,e.data,indexFromCoord(e.width*PIXEL_SIZE,t*PIXEL_SIZE,a),PIXEL_SIZE),r}throw"Pixel out of bounds: ("+t+", "+a+") of "+e.width+"x"+e.height}function putPixel(e,t,a,r){t>=0&&t<e.width&&a>=0&&a<e.height&&arraycopy(e.data,indexFromCoord(e.width*PIXEL_SIZE,t*PIXEL_SIZE,a),r,0,PIXEL_SIZE)}function colorsEqual(e,t){for(var a=0;a<PIXEL_SIZE;++a)if(e[a]!=t[a])return!1;return!0}function rgbToRgba(e){return[e[0],e[1],e[2],255]}function MyImageData(e,t){this.width=e,this.height=t,this.data=new Uint8ClampedArray(new ArrayBuffer(e*t*4))}function colorCardinality(e){for(var t={},a=0;a<e.height;a++)for(var r=0;r<e.width;r++){var o=getPixel(e,r,a);isDefined(t[o])?t[o]++:t[o]=1}return t}function medianCut(e){colorCardinality()}function palettizecolor(e,t){}function palettizeImage(e,t,a){for(var r=0;r<t.height;r++)for(var o=0;o<t.width;o++)putPixel(a,o,r,e[palettizecolor(getPixel(t,o,r),e)])}function interval(e,t,a){}function resample1d(e,t,a,r){for(var o=(e[1]-e[0])/(t[1]-t[0]),n=t[0],i=Math.floor(n+1),l=e[0],s=l+(i-n)*o;i<t[1];n=i,i++,l=s,s+=o)r.y0=n,r.y1=i,a([l,s],[n,i],r);r.y0=n,r.y1=t[1],a([l,e[1]],[n,t[1]],r)}function resample2d(e,t,a,r){resample1d([e[0][1],e[1][1]],[t[0][1],t[1][1]],function(){resample1d([e[0][0],e[1][0]],[t[0][0],t[1][0]],a,r)},r)}function rgbaToRgb(e){return[e[0],e[1],e[2]]}function scaleEagle2x(e,t,a){var r=getPixel(e,t>0?t-1:0,a>0?a-1:0),o=getPixel(e,t,a>0?a-1:0),n=getPixel(e,t<e.width-1?t+1:e.width-1,a>0?a-1:0),i=getPixel(e,t>0?t-1:0,a),l=getPixel(e,t,a),s=getPixel(e,t<e.width-1?t+1:e.width-1,a),c=getPixel(e,t>0?t-1:0,a<e.height-1?a+1:e.height-1),d=getPixel(e,t,a<e.height-1?a+1:e.height-1),u=getPixel(e,t<e.width-1?t+1:e.width-1,a<e.height-1?a+1:e.height-1);return[colorsEqual(r,o)&&colorsEqual(r,i)?r:l,colorsEqual(n,o)&&colorsEqual(n,s)?n:l,colorsEqual(c,d)&&colorsEqual(c,i)?c:l,colorsEqual(u,s)&&colorsEqual(u,d)?u:l]}function scaleEagle3x(e,t,a){var r=getPixel(e,t>0?t-1:0,a>0?a-1:0),o=getPixel(e,t,a>0?a-1:0),n=getPixel(e,t<e.width-1?t+1:e.width-1,a>0?a-1:0),i=getPixel(e,t>0?t-1:0,a),l=getPixel(e,t,a),s=getPixel(e,t<e.width-1?t+1:e.width-1,a),c=getPixel(e,t>0?t-1:0,a<e.height-1?a+1:e.height-1),d=getPixel(e,t,a<e.height-1?a+1:e.height-1),u=getPixel(e,t<e.width-1?t+1:e.width-1,a<e.height-1?a+1:e.height-1);return[colorsEqual(r,i)&&colorsEqual(r,o)?r:l,l,colorsEqual(n,o)&&colorsEqual(n,s)?n:l,l,l,l,colorsEqual(c,d)&&colorsEqual(c,i)?c:l,l,colorsEqual(u,s)&&colorsEqual(u,d)?u:l]}function getScale(){return scalers[values.scaler0].factor}function scale(e,t,a){for(var r=0;r<e.height;r++)for(var o=0;o<e.width;o++)for(var n=a.func(e,o,r),i=0,l=0;l<a.factor;l++)for(var s=0;s<a.factor;s++)putPixel(t,o*a.factor+s,r*a.factor+l,n[i]),i++}function lerp(e,t,a){return e+(t-e)*a}function limit(e,t,a){return e<t?t:e>a?a:e}function scaleShift(e,t,a){return e*a+t}function bias(e,t){return Math.pow(t,Math.log(e)/Math.log(.5))}function gain(e,t){return t<=.5?bias(2*t,1-e)/2:1-bias(2-2*t,1-e)/2}function intRandom(e){return Math.floor(random()*(e+1))%(e+1)}function pickRandom(e){return e[intRandom(e.length-1)]}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function extractParameters(e){var t=[],a=e.split("?");if(a.length>1)for(var r in a=a[1].split("&"),a){var o=a[r].split("=");t[o[0]]=o[1]}return t}function getNeighbours(e,t,a){for(var r=new Array,o=0;o<8;o++)try{r[o]=getPixel(e,t+neighbourOffsets[o][0],a+neighbourOffsets[o][1])}catch(e){}return r}function SpriteGenerator(e){this.id=e,processParameters(),loadDefaults(),buildGui("gui");var t=values.res,a=8,r=4;if(t>10&t<=15)a=6;else if(t>15&t<=20)a=5;else if(t>20&t<=28)a=4;else if(t>28)a=3;else a=8;viewW=r+a*(t*getScale()+r),viewH=r+a*(t*getScale()+r),backgroundcolor=rgbToRgba(palettes[values.pal].colors[0%palettes[values.pal].colors.length]),randomReseed(values.seed),this.canvas=document.getElementById(e),this.canvas.width=viewW,this.canvas.height=viewH,this.canvas.style.width="100%",this.canvas.style.height="auto";try{this.context=this.canvas.getContext("2d")}catch(e){throw"Couldn't get canvas context:"+e.description}this.context.ImageSmoothingEnabled=!1;try{this.tile=document.createElement("canvas")}catch(e){error("Couldn't create tile canvas:"+e.description)}this.tile.height=this.tile.width=values.res*getScale();try{this.tileContext=this.tile.getContext("2d")}catch(e){throw"Couldn't get tile context:"+e.description}this.tileData=this.tileContext.createImageData(this.tile.width,this.tile.height)}function inArray(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1}function isDefined(e){return!(void 0===e)}function validateReal(e,t){var a=new Number(e);return isNumber(a)||(a=t.default),isDefined(t.min)&&a<t.min?a=t.min:isDefined(t.max)&&a>t.max&&(a=t.max),a}function validateInteger(e,t){return Math.round(validateReal(e,t))}function validateList(e,t){var a=e.toLowerCase();return isDefined(t.options[a])||(a=t.default),a}function validateBool(e,t){return e}function buildControls(e,t){var a=1;for(var a in t){var r,o,n=t[a];if(isDefined(n.id)){o=n.id;try{r=properties[o]}catch(e){throw"No property for id:"+e.description}}switch(n.type){case"fieldset":var i,l=document.createElement("div");e.appendChild(l);var s=document.createElement("label");if(isDefined(o)){var c=document.createElement("input");c.type="hidden",c.name=o,c.value=!1,l.appendChild(c),i=r.label;var d=document.createElement("input");d.type="checkbox",d.id=d.name=n.id,d.value=!0,"true"==values[o]&&(d.checked="on"),s.htmlFor=d.id,l.appendChild(d)}else i=n.label;s.appendChild(document.createTextNode(i)),l.className="ctrl";var u=document.createElement("fieldset");buildControls(u,n.children),l.appendChild(u);break;case"submit":case"button":var f=document.createElement("button");"submit"==n.type?f.type="submit":f.type="button",f.onclick=actions[o].func,f.appendChild(document.createTextNode(actions[o].label)),e.appendChild(f),f.className="btn",f.id=o;break;case"property":var p,h,m,g;if(!isDefined(r))throw"Property does not exist: "+o;switch(r.type){case"integer":case"real":p=document.createElement("input"),"real"==r.type?(p.className="bar",p.id=p.name=o,p.value=values[o],h=document.createElement("output"),h.id=p.id+"v",p.setAttribute("oninput",p.id+"v.value = "+p.id+".value"),isDefined(r.min)&&isDefined(r.max)?p.type="range":p.type="number",p.step=isDefined(r.step)?r.step:1):(p.type="number",p.step=isDefined(r.step)?r.step:1,p.className="form-input"),isDefined(r.min)&&(p.min=r.min),isDefined(r.max)&&(p.max=r.max),p.id=p.name=o,p.value=values[o];break;case"bool":c=document.createElement("input");c.type="hidden",c.name=o,c.value=!1,e.appendChild(c),p=document.createElement("input"),m=document.createElement("span"),p.type="checkbox",p.id=p.name=o,p.value=!0,"true"==values[o]&&(p.checked="on");break;case"list":for(var v in p=document.createElement("select"),p.id=o,p.classList.add("form-select"),p.name=o,r.options){var b=document.createElement("option");b.value=v,b.appendChild(document.createTextNode(r.options[v].label)),p.appendChild(b)}p.value=values[o]}s=document.createElement("label"),g=document.createElement("label"),s.htmlFor=o,s.className=p.id,isDefined(p)&&isDefined(r.description)&&(s.className="tooltip tooltip-left "+p.id,s.setAttribute("data-tooltip",r.description)),s.appendChild(document.createTextNode(r.label)),"bool"==r.type?(e.appendChild(s),e.appendChild(g),g.appendChild(p),g.appendChild(m),g.className="contain",m.className="checkmark"):(e.appendChild(s),e.appendChild(p)),"real"==r.type&&(e.appendChild(h),h.id=p.id+"v",h.innerHTML=p.value)}}}function buildGui(e){var t=document.createElement("form");t.id="form",document.getElementById(e).appendChild(t),t.method="get",buildControls(t,controls)}function processParameters(){var e=extractParameters(window.location.href);for(var t in e)if(t=t.toLowerCase(),isDefined(properties[t])){var a=propertyTypes[properties[t].type];values[t]=a.validator(e[t],properties[t])}}function loadDefaults(){for(var e in properties)isDefined(values[e])||(values[e]=properties[e].default)}function main(){spriteGen=new SpriteGenerator("SpriteGenerator"),spriteGen.draw()}function reset(){for(var e in properties)values[e]=properties[e].default,document.getElementById(e).value=values[e],document.getElementById("colorsv").value=values.colors,document.getElementById("resv").value=values.res}function setProperty(e,t){document.getElementById(e).value=values[e]=t}function reseed(){setProperty("seed",Date.now())}function submit(){for(var e in 0==document.getElementById("autoreseed").checked&&reseed(),properties){var t=document.getElementById(e);if(!t)throw"Element id does not exist: "+e;var a=propertyTypes[properties[e].type];values[e]=a.validator(t.value,properties[e])}}function save(){var e=document.getElementById("SpriteGenerator");e.toBlob(function(e){saveAs(e,"sprites.png")})}var viewW,viewH,backgroundcolor,spriteGen,PIXEL_SIZE=4;ByteMap.prototype=Object.create(Uint8Array.prototype,{set:function(e,t,a){this[indexFromCoord(this.width,e,t)]=a},get:function(e,t){return this[indexFromCoord(this.width,e,t)]}}),LinearCongruentialGenerator.prototype={_random:function(){return this.seed=(this.a*this.seed+this.c)%this.m},random:function(){return this._random()/(this.m-1)},reseed:function(e){this.seed=(isDefined(e)?e:Date.now())%this.m}};var lcg0=new LinearCongruentialGenerator(2147483629,2147483587,Math.pow(2,31)-1),lcg1=new LinearCongruentialGenerator(25214903917,11,Math.pow(2,48));window.onerror=errorHandler;var buffer=new MyImageData(64,64),scalers={none:{label:"None",factor:1},eagle2x:{label:"Eagle2x",factor:2,func:scaleEagle2x},eagle3x:{label:"Eagle3x",factor:3,func:scaleEagle3x}},falloffs={constant:{label:"Constant",func:function(e){return 1}},linear:{label:"Linear",func:function(e){return Math.max(0,Math.min(e,1))}},cosine:{label:"Cosine",func:function(e){return.5*(1-Math.cos(e*Math.PI))}},spherical:{label:"Spherical",func:function(e){return Math.sqrt(1-(1-e)*(1-e))}}},neighbourOffsets=[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]],palettes={endesga32:{label:"ENDESGA-32",background:0,colors:[[24,20,37],[215,118,67],[234,212,170],[228,166,114],[184,111,80],[115,62,57],[62,39,49],[162,38,51],[228,59,68],[247,118,34],[254,174,52],[254,231,97],[99,199,77],[62,137,72],[38,92,66],[25,60,62],[18,78,137],[0,153,219],[44,232,245],[255,255,255],[192,203,220],[139,155,180],[90,105,136],[58,68,102],[38,43,68],[190,74,47],[255,0,68],[104,56,108],[181,80,136],[246,117,122],[232,183,150],[194,133,105]]},fleja:{label:"Fleja",background:0,colors:[[31,24,51],[43,46,66],[65,72,89],[104,113,122],[144,161,168],[182,203,207],[255,255,255],[252,191,138],[181,128,87],[138,80,62],[92,58,65],[201,48,56],[222,106,56],[255,173,59],[255,229,150],[252,249,96],[180,214,69],[81,196,63],[48,156,99],[35,109,122],[38,79,110],[35,54,99],[65,114,145],[76,147,173],[99,194,201],[148,210,212],[184,253,255],[60,41,64],[70,39,92],[130,100,129],[247,164,139],[194,113,130],[133,45,102]]},dawnbringer:{label:"DawnBringer",background:0,colors:[[20,12,28],[68,36,52],[48,52,109],[78,74,78],[133,76,48],[52,101,36],[208,70,72],[117,113,97],[89,125,206],[210,125,44],[133,149,161],[109,170,44],[210,170,153],[109,194,202],[218,212,94],[222,238,214]]},sweetie16:{label:"Sweetie-16",background:0,colors:[[26,28,44],[93,39,93],[177,62,83],[239,125,8],[255,205,117],[167,240,112],[56,183,100],[37,113,121],[41,54,111],[59,93,201],[65,166,246],[115,239,247],[244,244,244],[148,176,194],[86,108,134],[51,60,87]]},taffy16:{label:"Taffy-16",background:0,colors:[[34,37,51],[98,117,186],[163,192,230],[250,255,252],[255,171,123],[255,108,122],[220,67,91],[63,72,194],[68,141,231],[43,219,114],[167,245,71],[255,235,51],[245,137,49],[219,75,61],[166,61,87],[54,53,77]]},pastel:{label:"Oh Hell, Pastel",background:0,colors:[[88,68,120],[252,153,119],[252,189,144],[250,230,170],[255,247,213],[247,246,166],[163,217,106],[128,217,155],[87,207,201],[81,192,219],[112,165,212],[109,116,207],[132,89,201],[190,87,194],[222,118,165]]},firestorm:{label:"Firestorm",background:0,colors:[[27,32,50],[70,52,74],[249,94,62],[253,75,53],[236,103,86],[255,132,95],[255,161,95],[253,222,133],[255,236,179]]},pico:{label:"PICO8",background:0,colors:[[0,0,0],[95,87,79],[194,195,199],[255,241,232],[255,236,39],[255,163,0],[255,204,170],[171,82,54],[255,119,168],[255,0,77],[131,118,156],[126,37,83],[41,173,255],[29,43,83],[0,135,81],[0,228,54]]},gameboy:{label:"Kirokaze Gameboy",background:0,colors:[[51,44,80],[70,135,145],[148,227,68],[226,243,228]]},blkneo:{label:"BLK-NEO",background:0,colors:[[0,0,0],[18,23,61],[41,50,104],[70,75,140],[107,116,178],[144,158,221],[193,217,242],[255,255,255],[255,204,208],[242,159,170],[195,114,137],[153,76,105],[114,51,82],[63,31,60],[178,46,105],[229,66,134],[255,110,175],[255,165,213],[140,255,155],[66,188,127],[34,137,110],[20,102,91],[15,74,76],[10,42,51],[29,26,89],[50,45,137],[53,74,178],[62,131,209],[80,185,235],[140,218,255],[180,131,239],[133,76,191],[93,47,140],[67,30,102],[255,224,145],[255,170,110],[255,105,90],[178,60,64],[114,28,47],[165,38,57],[221,55,69],[255,102,117],[120,250,230],[39,211,203],[0,170,165],[0,135,130]]},arne:{label:"Arne",background:0,colors:[[0,0,0],[157,157,157],[255,255,255],[190,38,51],[224,111,139],[73,60,43],[164,100,34],[235,137,49],[247,226,107],[47,72,78],[68,137,26],[163,206,39],[27,38,50],[0,87,132],[49,162,242],[178,220,239]]},cga1:{label:"CGA1",background:0,colors:[[0,0,0],[255,85,255],[85,255,255],[255,255,255]]},cga2:{label:"CGA2",background:0,colors:[[0,0,0],[255,85,85],[85,255,255],[255,255,255]]},nes:{label:"NES",background:0,colors:[[0,0,0],[255,255,255],[199,199,199],[128,128,128],[166,252,255],[15,215,255],[0,119,255],[0,61,166],[179,236,255],[105,162,255],[33,85,255],[0,18,176],[218,171,235],[212,128,255],[130,55,250],[68,0,150],[255,168,249],[255,69,243],[235,47,181],[161,0,94],[255,171,179],[255,97,139],[255,41,80],[199,0,40],[255,210,176],[255,136,51],[255,34,0],[186,6,0],[255,239,166],[255,156,18],[214,50,0],[140,23,0],[255,247,156],[250,188,32],[196,98,0],[92,47,0],[215,232,149],[159,227,14],[53,128,0],[16,69,0],[166,237,175],[43,240,53],[5,143,0],[5,74,0],[162,242,218],[12,240,164],[0,138,85],[0,71,46],[153,255,252],[5,251,255],[0,153,204],[0,65,102],[221,221,221],[94,94,94],[33,33,33],[255,255,255]]}};SpriteGenerator.prototype.generateTile=function(){for(var e=this.context.createImageData(values.res,values.res),t=random()<=.75,a=random()<=.25,r=random()<=.25,o=random()<=.25,n=e.width/2,i=e.height/2,l=t?Math.ceil(n):e.width,s=a?Math.ceil(i):e.height,c=[],d=0;d<values.colors;d++)c[d]=pickRandom(palettes[values.pal].colors);for(var u=0;u<s;u++)for(var f=0;f<l;f++){var p=falloffs.linear.func(1-Math.abs((n-(f+.5))/n)),h=falloffs.linear.func(1-Math.abs((i-(u+.5))/i)),m=lerp(0,1,bias(.5,gain(.5,p*h))),g=random();putPixel(e,f,u,g<=m?rgbToRgba(pickRandom(c)):backgroundcolor)}for(u=0;u<s;u++)for(f=0;f<l;f++){var v=getNeighbours(e,f,u),b=0;for(d=0;d<v.length;d++)null==v[d]||colorsEqual(backgroundcolor,v[d])||b++;1==b?random()<=.5&&putPixel(e,f,u,backgroundcolor):0==b&&random()<=.875&&putPixel(e,f,u,backgroundcolor)}l=t?Math.floor(n+.5):e.width,s=a?Math.floor(i+.5):e.height;for(u=0;u<s;u++)for(f=0;f<l;f++){var y=getPixel(e,f,u);t&&putPixel(e,e.width-1-f,u,y),a&&putPixel(e,f,e.height-1-u,y),t&&a&&putPixel(e,e.width-1-f,e.height-1-u,y)}l=e.width,s=e.height;for(u=0;u<s;u++)for(f=0;f<l;f++){y=getPixel(e,f,u);r&&putPixel(e,u,f,y),o&&putPixel(e,e.width-1-u,e.height-1-f,y)}var w=e;if("none"!=values.scaler0){var x=scalers[values.scaler0],E=this.context.createImageData(w.width*x.factor,w.height*x.factor);scale(w,E,x),w=E}return w},SpriteGenerator.prototype.draw=function(){this.context.fillStyle="rgb("+backgroundcolor[0]+", "+backgroundcolor[1]+", "+backgroundcolor[2]+")",this.context.fillRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<8;e++)for(var t=0;t<8;t++){var a=this.generateTile();this.context.putImageData(a,4+t*(values.res*getScale()+4),4+e*(values.res*getScale()+4))}};var propertyTypes={integer:{validator:validateReal},real:{validator:validateReal},list:{validator:validateList},bool:{validator:validateBool}},properties={seed:{type:"integer",label:"Seed",default:Date.now()},autoreseed:{type:"bool",label:"Lock",default:"false"},pal:{type:"list",label:"Color Palette",default:"endesga32",options:palettes},colors:{type:"real",label:"Color Amount",default:3,min:1,max:8},res:{type:"real",label:"Resolution",default:16,min:8,max:32},scaler0:{type:"list",label:"Scaler",default:"eagle2x",options:scalers}},values={},actions={save:{label:"Get image",func:save},reset:{label:"Reset",func:reset},submit:{label:"Generate",func:submit},reseed:{label:"Reseed",func:reseed}},controls=[{type:"fieldset",children:[{type:"submit",id:"submit"}]},{type:"fieldset",children:[{type:"property",id:"pal"}]},{type:"fieldset",children:[{type:"property",id:"scaler0"}]},{type:"fieldset",children:[{type:"property",id:"colors"}]},{type:"fieldset",children:[{type:"property",id:"res"}]},{type:"fieldset",children:[{type:"property",id:"seed"},{type:"property",id:"autoreseed"}]},{type:"fieldset",children:[{type:"button",id:"save"}]},{type:"fieldset",children:[{type:"button",id:"reset"}]}];(function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof exports?t():(t(),e.FileSaver={})})(this,function(){function e(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function t(e,t,a){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){n(r.response,t,a)},r.onerror=function(){console.error("could not download file")},r.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,n=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype?function(e,n,i){var l=o.URL||o.webkitURL,s=document.createElement("a");n=n||e.name||"download",s.download=n,s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?r(s):a(s.href)?t(e,n,i):r(s,s.target="_blank")):(s.href=l.createObjectURL(e),setTimeout(function(){l.revokeObjectURL(s.href)},4e4),setTimeout(function(){r(s)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,i){if(n=n||o.name||"download","string"!=typeof o)navigator.msSaveOrOpenBlob(e(o,i),n);else if(a(o))t(o,n,i);else{var l=document.createElement("a");l.href=o,l.target="_blank",setTimeout(function(){r(l)})}}:function(e,a,r,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return t(e,a,r);var i="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||i&&l)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},c.readAsDataURL(e)}else{var d=o.URL||o.webkitURL,u=d.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){d.revokeObjectURL(u)},4e4)}});o.saveAs=n.saveAs=n,"undefined"!=typeof module&&(module.exports=n)});